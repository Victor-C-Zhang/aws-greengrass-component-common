// Applies BrazilGradle plugin then uses it to setup the build script classpath.
buildscript {
  apply plugin: 'brazil-gradle'
  dependencies {
    classpath brazilGradle.tool('BrazilGradleQualityDefaults')
  }
}

/*
 Applies core Gradle plugins, which are ones built into Gradle itself.
*/
plugins {
  // Java for compile and unit test of Java source files. Read more at:
  // https://docs.gradle.org/current/userguide/java_plugin.html
  id 'java'

  // Checkstyle for style checks and reports on Java source files. Read more at:
  // https://docs.gradle.org/current/userguide/checkstyle_plugin.html
  id 'checkstyle'

  // JaCoCo for coverage metrics and reports of Java source files. Read more at:
  // https://docs.gradle.org/current/userguide/jacoco_plugin.html
  id 'jacoco'
}

/*
 Applies community Gradle plugins, usually added as build-tools in Config.
*/

// BrazilGradleQualityDefaults for enabling brazil specific quality rules and
// reports for other quality plugins. Read more at:
// https://w.amazon.com/bin/view/BrazilGradle/QualityDefaults
apply plugin: 'brazil-quality-defaults'

// SpotBugs for quality checks and reports of source files. Read more at:
// https://spotbugs.readthedocs.io/en/stable/gradle.html
apply plugin: 'com.github.spotbugs'

/*
 Java plugin default project layout is 'src/main/java' and 'src/test/java'.
 Uncomment below if you instead want to use 'src' and 'tst'.

sourceSets.main.java.srcDirs = ['src']
sourceSets.test.java.srcDirs = ['tst']
*/

/*
 Configures the Checkstyle "checkstyle" plugin. Remove this and the plugin if
 you want to skip these checks and report generation.
*/
checkstyle {
  sourceSets = [sourceSets.main]
  ignoreFailures = false
}

/*
 Configures the JaCoCo "jacoco" plugin. Remove this if you want to skip
 these checks and report generation.

 Set minimum code coverage to fail build, where 0.01 = 1%.
*/
check.dependsOn jacocoTestCoverageVerification
jacocoTestCoverageVerification {
  violationRules {
    rule {
      limit {
        minimum = 0.01
      }
    }
  }
}

/*
 Configures the SpotBugs "com.github.spotbugs" plugin. Remove this and the
 plugin to skip these checks and report generation.
*/
spotbugs {
  sourceSets = [sourceSets.main]
  ignoreFailures = false
}

/*
 Resolve build and test dependencies using BrazilGradle.
*/
dependencies {
  implementation brazilGradle.build()
  testImplementation brazilGradle.testbuild()
}

/*
 Specifies that JUnit Platform (a.k.a. JUnit 5) should be used to execute tests.

 For mixed JUnit 4 and 5 tests, add 'JUnit-4-12-migration = 5.x;' to
 test-dependencies in Config.
*/
test {
  useJUnitPlatform()
}

